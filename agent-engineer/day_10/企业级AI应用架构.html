<html style="margin: 0; padding: 0; width: 100%; height: 100%;"><head>
        <meta charset="uft-8">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
    
      
    <script id="he-diagram-proxy" class="__helper-box">
      
  function escape(str) {
      return str.replace(/[&<>'"]/g, 
        tag => ({
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          "'": '&#39;',
          '"': '&quot;'
        }[tag] || tag));
    }
    
  function unescape(str) {
    const map = {
      '&amp;': '&',
      '&lt;': '<',
      '&gt;': '>',
      '&#39;': "'",
      '&quot;': '"'
    };
    return str.replace(/&(amp|lt|gt|#39|quot);/g, 
      match => map[match]);
  }
  
  function sendMessage2Parent(action) {
    window.parent.postMessage(action, '*');
  }

      
      const cdn = 'https://lf-coze-web-cdn.coze.cn/obj/coze-web-cn/coze-drawio/index.26b84e9.html';
      
      
    document.addEventListener('DOMContentLoaded', () => {
        const diagramDivs = document.querySelectorAll('div[data-he-diagram]');
        diagramDivs.forEach(diagramDiv => {
          const iframe = diagramDiv.querySelector('iframe[data-he-frame]');
          const codeDiv = diagramDiv.querySelector('div[data-he-code]');
         
          if (iframe && codeDiv) {
            // 发送消息方法，与use-message保持一致
            const sendMessage = (action) => {
              if (!iframe.contentWindow) {
                console.warn('Iframe not ready');
                return;
              }

              try {
                const message = JSON.stringify(action);
                iframe.contentWindow.postMessage(
                  message,
                  cdn
                );
              } catch (error) {
                console.error('Failed to send message to draw.io:', error);
              }
            };
            
            // 为iframe添加唯一标识
            const iframeId = Math.random().toString(36).substring(2);
            iframe.dataset.iframeId = iframeId;
            codeDiv.dataset.iframeId = iframeId;

            // 处理init事件
            const handleInit = () => {
              const xml = unescape(codeDiv.innerHTML);
              sendMessage({
                action: 'load',
                xml: xml,
                autosave: 1
              });
            };
            
            const handleConfigure = () => {
              sendMessage({
                action: 'configure',
                config: {
                  defaultFonts: ['Arial', 'Helvetica', 'sans-serif'],
                  css: `
.geEditor > .geTabContainer {
  display: none;
}

.geSidebarFooter {
  display: none;
}

.geMenubarContainer {
  display: none;
}

.geMenubar {
  display: none;
}

.geToolbarContainer {
  background: rgba(255, 255, 255, 1);
  border-top: none !important;
  border-color: rgba(82, 100, 154, 0.13) !important;
}
.geDiagramContainer {
  background: rgba(255, 255, 255, 1);
}

`,
                }
              });
            };
            
            const handleLoad = () => {
              sendMessage2Parent({
                event: 'drawio_loaded',
                data: {
                 iframeId,
                }
              });         
            }

            // 处理autosave事件
            const handleAutosave = (data) => {
              const targetCodeDiv = diagramDiv.querySelector(
                `div[data-he-code][data-iframe-id="${iframeId}"]`
              );
              
              
              if (targetCodeDiv) {
                const innerHTML = escape(data.xml);
                
                sendMessage2Parent({
                  event: 'drawio_autosave',
                  data: {
                   iframeId,
                   innerHTML,
                  }
                });
                
                sendMessage({
                  action: 'status',
                  message: 'Saved',
                  modified: false,
                });
              }
            };
            
            const handleExport = (data) => {
              sendMessage2Parent({
                event: 'drawio_export',
                data: data
              });
            }

            // 监听消息
            window.addEventListener('message', (event) => {
              if (event.source !== iframe.contentWindow) {
                return;
              }
            
              const data = typeof event.data === 'string' ? JSON.parse(event.data) : event.data;
              switch(data.event) {
                case 'init':
                  handleInit();
                  break;
                case 'load':
                  handleLoad();
                  break;
                case 'configure':
                  handleConfigure();
                  break;
                case 'autosave':
                  handleAutosave(data);
                  break;
                case 'export':
                  handleExport(data);
                  break;
              }
            });
          }
        });
      })
  
      
      
  window.addEventListener('message', (event) => {
    if(typeof event.data ==='object' && event.data.iframeID) { 
      const targetIframe = document.querySelector(`div[data-he-diagram] iframe[data-he-frame][data-iframe-id="${event.data.iframeID}"]`);
      
      if(!targetIframe) {
        return;
      }
      
      switch(event.data.event) {
        case 'drawio_export':
          targetIframe.contentWindow?.postMessage(
            event.data.message,
            cdn
          )
          break;
          
        default:
          targetIframe.contentWindow?.postMessage(
            event.data.message,
            cdn
          )
          break;
      }
    }
  })

    </script>
  
      </head>
    
    <body style="margin: 0; padding: 0; width: 100%; height: 100%;">
      <div data-he-diagram="true" style="width: 100%; height: 100%; overflow: hidden;" id="diagram-1">
       <div data-he-code="true" style="display: none;" data-iframe-id="f6k9vqkw7d">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;mxfile host="app.diagrams.net" version="24.0.0"&gt;
  &lt;diagram id="enterprise_ai_architecture" name="企业级AI应用架构"&gt;
    &lt;mxGraphModel dx="1554" dy="946" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" background="#ffffff" math="0" shadow="0"&gt;
      &lt;root&gt;
        &lt;mxCell id="0" /&gt;
        &lt;mxCell id="1" parent="0" /&gt;

        
        &lt;mxCell id="lbl_client" value="客户端层" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;fontColor=#333333;" parent="1" vertex="1"&gt;
          &lt;mxGeometry x="40" y="20" width="100" height="40" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="lbl_gateway" value="API网关层" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;fontColor=#333333;" parent="1" vertex="1"&gt;
          &lt;mxGeometry x="40" y="180" width="100" height="40" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="lbl_service" value="服务层" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;fontColor=#333333;" parent="1" vertex="1"&gt;
          &lt;mxGeometry x="40" y="440" width="100" height="40" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="lbl_data" value="数据层" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;fontColor=#333333;" parent="1" vertex="1"&gt;
          &lt;mxGeometry x="40" y="760" width="100" height="40" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="lbl_monitor" value="监控层" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1;fontColor=#333333;" parent="1" vertex="1"&gt;
          &lt;mxGeometry x="40" y="960" width="100" height="40" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="client_layer" value="Web/移动端应用" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;strokeWidth=2;verticalAlign=top;align=center;spacingTop=10;fontSize=14;fontStyle=1;" parent="1" vertex="1"&gt;
          &lt;mxGeometry x="240" y="40" width="1120" height="80" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="gateway_layer" value="统一API网关" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=2;verticalAlign=top;align=center;spacingTop=10;fontSize=14;fontStyle=1;" parent="1" vertex="1"&gt;
          &lt;mxGeometry x="240" y="160" width="1120" height="140" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="gateway_router" value="路由管理" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#6c8ebf;fontSize=12;" parent="gateway_layer" vertex="1"&gt;
          &lt;mxGeometry x="120" y="40" width="200" height="50" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="gateway_rate_limit" value="限流熔断" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#6c8ebf;fontSize=12;" parent="gateway_layer" vertex="1"&gt;
          &lt;mxGeometry x="460" y="40" width="200" height="50" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="gateway_auth" value="认证鉴权" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#6c8ebf;fontSize=12;" parent="gateway_layer" vertex="1"&gt;
          &lt;mxGeometry x="800" y="40" width="200" height="50" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        
        &lt;mxCell id="rag_service_container" value="RAG服务" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;verticalAlign=top;align=center;spacingTop=10;fontSize=14;fontStyle=1;" parent="1" vertex="1"&gt;
          &lt;mxGeometry x="240" y="320" width="540" height="340" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="rag_retrieval" value="检索引擎" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366;fontSize=12;" parent="rag_service_container" vertex="1"&gt;
          &lt;mxGeometry x="40" y="60" width="460" height="60" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="rag_rerank" value="重排序模型" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366;fontSize=12;" parent="rag_service_container" vertex="1"&gt;
          &lt;mxGeometry x="40" y="140" width="460" height="60" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="rag_generator" value="答案生成器" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366;fontSize=12;" parent="rag_service_container" vertex="1"&gt;
          &lt;mxGeometry x="40" y="220" width="460" height="60" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="cache_service_container" value="缓存服务" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=2;verticalAlign=top;align=center;spacingTop=10;fontSize=14;fontStyle=1;" parent="1" vertex="1"&gt;
          &lt;mxGeometry x="820" y="320" width="540" height="340" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="cache_memory" value="LRU内存缓存" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366;fontSize=12;" parent="cache_service_container" vertex="1"&gt;
          &lt;mxGeometry x="40" y="60" width="460" height="60" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="cache_redis" value="Redis分布式缓存" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366;fontSize=12;" parent="cache_service_container" vertex="1"&gt;
          &lt;mxGeometry x="40" y="140" width="460" height="60" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="cache_protection" value="穿透/雪崩防护" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#82b366;fontSize=12;" parent="cache_service_container" vertex="1"&gt;
          &lt;mxGeometry x="40" y="220" width="460" height="60" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="data_layer" value="数据存储层" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;strokeWidth=2;verticalAlign=top;align=center;spacingTop=10;fontSize=14;fontStyle=1;dashed=1;dashPattern=8 4;" parent="1" vertex="1"&gt;
          &lt;mxGeometry x="240" y="680" width="1120" height="180" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="data_milvus" value="向量数据库&amp;lt;br&amp;gt;(Milvus)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffffff;strokeColor=#b85450;fontSize=12;" parent="data_layer" vertex="1"&gt;
          &lt;mxGeometry x="120" y="60" width="180" height="90" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="data_postgres" value="关系数据库&amp;lt;br&amp;gt;(PostgreSQL)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffffff;strokeColor=#b85450;fontSize=12;" parent="data_layer" vertex="1"&gt;
          &lt;mxGeometry x="380" y="60" width="180" height="90" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="data_redis" value="缓存数据库&amp;lt;br&amp;gt;(Redis)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffffff;strokeColor=#b85450;fontSize=12;" parent="data_layer" vertex="1"&gt;
          &lt;mxGeometry x="640" y="60" width="180" height="90" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="data_mongo" value="文档存储&amp;lt;br&amp;gt;(MongoDB)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ffffff;strokeColor=#b85450;fontSize=12;" parent="data_layer" vertex="1"&gt;
          &lt;mxGeometry x="900" y="60" width="180" height="90" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="monitor_layer" value="可观测性体系" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;verticalAlign=top;align=center;spacingTop=10;fontSize=14;fontStyle=1;" parent="1" vertex="1"&gt;
          &lt;mxGeometry x="240" y="880" width="1130" height="180" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="monitor_prometheus" value="指标收集&amp;lt;br&amp;gt;(Prometheus)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#d6b656;fontSize=12;" parent="monitor_layer" vertex="1"&gt;
          &lt;mxGeometry x="120" y="60" width="200" height="60" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="monitor_grafana" value="可视化面板&amp;lt;br&amp;gt;(Grafana)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#d6b656;fontSize=12;" parent="monitor_layer" vertex="1"&gt;
          &lt;mxGeometry x="380" y="60" width="200" height="60" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="monitor_elk" value="日志聚合&amp;lt;br&amp;gt;(ELK Stack)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#d6b656;fontSize=12;" parent="monitor_layer" vertex="1"&gt;
          &lt;mxGeometry x="640" y="60" width="200" height="60" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="monitor_alert" value="告警管理&amp;lt;br&amp;gt;(AlertManager)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#d6b656;fontSize=12;" parent="monitor_layer" vertex="1"&gt;
          &lt;mxGeometry x="900" y="60" width="200" height="60" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="link_client_gateway" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#666666;entryX=0.5;entryY=0;exitX=0.5;exitY=1;" parent="1" source="client_layer" target="gateway_layer" edge="1"&gt;
          &lt;mxGeometry relative="1" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="link_gateway_rag" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#6c8ebf;entryX=0.5;entryY=0;exitX=0.25;exitY=1;" parent="1" source="gateway_layer" target="rag_service_container" edge="1"&gt;
          &lt;mxGeometry relative="1" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="link_gateway_cache" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#6c8ebf;entryX=0.5;entryY=0;exitX=0.75;exitY=1;" parent="1" source="gateway_layer" target="cache_service_container" edge="1"&gt;
          &lt;mxGeometry relative="1" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="link_rag_data" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#b85450;dashed=1;entryX=0.5;entryY=0;exitX=0.25;exitY=1;" parent="1" source="rag_service_container" target="data_layer" edge="1"&gt;
          &lt;mxGeometry relative="1" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="link_cache_data" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#b85450;dashed=1;entryX=0.5;entryY=0;exitX=0.75;exitY=1;" parent="1" source="cache_service_container" target="data_layer" edge="1"&gt;
          &lt;mxGeometry relative="1" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="link_rag_cache" value="缓存协作" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;strokeColor=#82b366;dashed=1;curved=1;entryX=1;entryY=0.5;exitX=0;exitY=0.5;" parent="1" source="rag_service_container" target="cache_service_container" edge="1"&gt;
          &lt;mxGeometry relative="1" as="geometry" /&gt;
        &lt;/mxCell&gt;

        
        &lt;mxCell id="link_gateway_monitor" value="指标" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#d6b656;dashed=1;entryX=0.2;entryY=0;exitX=0.2;exitY=1;" parent="1" source="gateway_layer" target="monitor_layer" edge="1"&gt;
          &lt;mxGeometry relative="1" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="link_rag_monitor" value="日志" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#d6b656;dashed=1;entryX=0.4;entryY=0;exitX=0.4;exitY=1;" parent="1" source="rag_service_container" target="monitor_layer" edge="1"&gt;
          &lt;mxGeometry relative="1" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="link_cache_monitor" value="告警" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#d6b656;dashed=1;entryX=0.6;entryY=0;exitX=0.6;exitY=1;" parent="1" source="cache_service_container" target="monitor_layer" edge="1"&gt;
          &lt;mxGeometry relative="1" as="geometry" /&gt;
        &lt;/mxCell&gt;
        &lt;mxCell id="link_data_monitor" value="追踪" style="edgeStyle=orthogonalEdgeStyle;rounded=1;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=1;strokeColor=#d6b656;dashed=1;entryX=0.8;entryY=0;exitX=0.8;exitY=1;" parent="1" source="data_layer" target="monitor_layer" edge="1"&gt;
          &lt;mxGeometry relative="1" as="geometry" /&gt;
        &lt;/mxCell&gt;

      &lt;/root&gt;
    &lt;/mxGraphModel&gt;
  &lt;/diagram&gt;
&lt;/mxfile&gt;</div>
      <iframe data-he-frame="true" src="https://lf-coze-web-cdn.coze.cn/obj/coze-web-cn/coze-drawio/index.26b84e9.html?embed=1&amp;noSplash=1&amp;spin=0&amp;noExitBtn=1&amp;noSaveBtn=1&amp;configure=1&amp;lang=zh&amp;saveAndExit=0&amp;mode=side&amp;readonly=0&amp;proto=json&amp;dev=1&amp;dark=0&amp;plugins=1&amp;p=toggle&amp;toggleLeft=0&amp;toggleRight=0" class="__helper-box" style="width: 100%; height: 100%; border: none;" data-iframe-id="f6k9vqkw7d"></iframe></div>
    
    

  </body></html>